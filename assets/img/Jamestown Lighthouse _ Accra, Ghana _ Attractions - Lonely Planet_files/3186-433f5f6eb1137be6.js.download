"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3186],{22644:function(e,t,n){n.d(t,{y:function(){return w}});var l=n(85893),s=n(67294),a=n(45697),i=n.n(a),c=n(94184),o=n.n(c),r=n(66645),d=n(14996),m=n(23516),u=n(34097),h=n(52859),x=n(63762),p=n(56839),b=n(75606),f=n(68095);function w(e,t){function n(n){let{esid:a,type:i,slug:c,hocTagularCtx:w,...y}=n,[N,v]=(0,s.useState)(!1),[g,j]=(0,s.useState)(null),[C,E]=(0,s.useState)(!1),[k,T]=(0,s.useState)(""),S=(0,s.useRef)(null),O=(0,s.useRef)(null),[L,_]=(0,s.useState)([]),[I,U]=(0,s.useState)([]),[A,D]=(0,s.useState)(!1),{isLoading:V,user:R,mutate:H}=(0,s.useContext)(r.S),B=async()=>{v(!0),await fetch("/api/favorites",{method:"POST",body:JSON.stringify({ref_type:i,ref_id:a,ref_slug:c})}).then(e=>e.json()).then(()=>{H(),(0,f.yv)("click",{actionOutcome:"SAVE",outboundUrl:"".concat("https://www.lonelyplanet.com","/").concat(c),webElement:{location:"SECTION",text:"SAVE",elementType:"LINK",...w}})}).catch(e=>{console.error(e),v(!1)})},M=async()=>{v(!0),await fetch("/api/favorites/".concat(g.id),{method:"DELETE"}).then(e=>e.json()).then(()=>{H(),j(null),(0,f.yv)("click",{actionOutcome:"UNSAVE",outboundUrl:"".concat("https://www.lonelyplanet.com","/").concat(c),webElement:{location:"SECTION",text:"UNSAVE",elementType:"LINK",...w}})}).catch(e=>{console.error(e),v(!1)})},P=async e=>{v(!0),await fetch("/api/lists",{method:"POST",body:JSON.stringify({list_name:e})}).then(e=>e.json()).then(t=>{U([t.data.id,...I]),H(),w&&(0,f.yv)("click",{actionOutcome:"LISTCREATED",outboundUrl:"".concat("https://www.lonelyplanet.com","/").concat(c),webElement:{location:"MODAL",text:e,elementType:"BUTTON",...w}}),O.current.scroll({top:O.current.scrollHeight,behavior:"smooth"}),T("")}).catch(e=>{console.error(e),v(!1)})},K=async e=>{e.preventDefault(),v(!0);let{form:t=e.target}=e.target,n=new FormData(t).getAll("list-checkbox"),l=R.lists.filter(e=>e.items.some(e=>e.esid===a)).map(e=>e.id),s=n.filter(e=>!l.includes(e)).map(e=>({action:g?"add":"create",list_id:e,item_id:a,fav_id:null==g?void 0:g.id})),i=R.lists.filter(e=>!e.items.find(e=>e.esid===a)).map(e=>e.id),o=L.filter(e=>!n.includes(e.id)).filter(e=>!i.includes(e.id)).map(e=>({action:"remove",list_id:e.id,item_id:a,fav_id:null==g?void 0:g.id})),r=[...s,...o].reduce((e,t)=>("remove"===t.action&&e.push(fetch("/api/lists/".concat(t.list_id,"/items/").concat(t.fav_id),{method:"DELETE"})),"add"===t.action&&e.push(fetch("/api/lists/".concat(t.list_id,"/items/").concat(t.fav_id),{method:"POST"})),e),[]);Promise.all(r).then(e=>e.some(e=>!e.ok)?Promise.reject(Error("Error in all()")):e).then(()=>{H();let e=n.reduce((e,t)=>{let{name:n}=R.lists.find(e=>e.id===t);return e.push(n),e},[]).join(", ");(0,f.yv)("click",{actionOutcome:"LISTSAVED",outboundUrl:"".concat("https://www.lonelyplanet.com","/").concat(c),webElement:{location:"MODAL",text:e,elementType:"BUTTON",...w}}),E(!1)}).catch(e=>{console.error(e),v(!1)})};(0,s.useEffect)(()=>{if(!R)return;_(R.lists);let e=null==R?void 0:R.favorites.find(e=>e.esid===a);e&&j(e)},[R,a]),(0,s.useEffect)(()=>{v(!1)},[R]);let q=e=>{S.current&&!S.current.contains(e.target)&&E(!1)};return(0,s.useEffect)(()=>(C&&document.addEventListener("click",q,!0),document.removeEventListener("click",q)),[C]),(0,l.jsxs)("div",{className:o()("relative",t),ref:S,children:[!R&&!V&&(0,l.jsx)("div",{className:"z-30 absolute top-0 right-0 m-3 rounded",children:(0,l.jsx)(d.m,{action:"bookmark",className:"p-2 text-md rounded bg-black w-8 h-8 flex justify-center items-center",onClick:()=>{(0,f.yv)("click",{actionOutcome:"AUTHREDIRECT",outboundUrl:"".concat("https://www.lonelyplanet.com","/api/auth/login"),webElement:{location:"SECTION",text:"SAVE",elementType:"LINK",...w}})},children:(0,l.jsx)(m.r,{className:"text-white"})})}),R&&(0,l.jsx)("div",{className:"z-30 absolute top-0 right-0 m-3 rounded",children:(0,l.jsxs)("div",{className:"relative flex group transition-all",children:[g&&(0,l.jsx)("button",{type:"button",className:o()("w-8 h-8 flex justify-center items-center mr-1 rounded border border-black-200 bg-black hover:bg-blue","md:opacity-0 group-hover:opacity-100",{"md:opacity-100":C}),onClick:()=>{E(!0),(0,f.yv)("click",{actionOutcome:"INTERNALLINK",outboundUrl:"".concat("https://www.lonelyplanet.com","/").concat(c),webElement:{location:"SECTION",text:"LISTICON",elementType:"LINK",...w}})},children:(0,l.jsx)(u.$,{className:"text-white"})}),(0,l.jsxs)("button",{type:"button",disabled:N,onClick:g?M:B,className:"w-8 h-8 flex justify-center items-center rounded border border-black-200 bg-black hover:bg-blue p-2 text-sm text-white",children:[(0,l.jsx)(h.g,{className:o()({hidden:!N},"animate-spin")}),g?(0,l.jsx)(m.k,{className:o()({hidden:N})}):(0,l.jsx)(m.r,{className:o()({hidden:N})})]}),(0,l.jsxs)("div",{className:o()("absolute top-0 right-0 min-w-[280px] mt-12 rounded shadow bg-white",{hidden:!C}),children:[(0,l.jsx)("div",{className:"w-3 h-3 bg-white rotate-45 absolute top-0 right-0 -translate-x-11 -translate-y-1/2"}),(0,l.jsx)("button",{type:"button",className:"absolute top-0 right-0 p-3",onClick:()=>{(0,f.yv)("click",{actionOutcome:"CLOSE",outboundUrl:"".concat("https://www.lonelyplanet.com","/").concat(c),webElement:{location:"MODAL",text:"X",elementType:"BUTTON",...w}}),E(!1)},children:(0,l.jsx)(x.p,{})}),(0,l.jsxs)("form",{onSubmit:K,className:"w-full",children:[(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsx)("legend",{className:"text-md text-center font-semibold",children:"Save to list"}),(0,l.jsx)("hr",{className:"my-2 text-black-100"}),0===L.length&&(0,l.jsx)("div",{className:"min-h-[112px] flex items-center",children:(0,l.jsx)("p",{className:"text-slate text-sm text-center",children:"Create a list to start organizing your saved items."})}),L.length>0&&(0,l.jsx)("div",{children:(0,l.jsx)("fieldset",{className:"min-h-[112px] max-h-[112px] overflow-y-scroll",ref:O,children:L.filter(e=>0>e.name.indexOf("Untitled List -")).map(e=>(0,l.jsxs)("label",{className:"p-1 flex",htmlFor:(0,b.w)(e.id),children:[(0,l.jsx)("input",{id:(0,b.w)(e.id),name:"list-checkbox",type:"checkbox",value:e.id,defaultChecked:e.items.some(e=>e.esid===a)||I.includes(e.id),onChange:t=>{A||D(!0),t.target.checked&&(0,f.yv)("click",{actionOutcome:"LISTSELECT",outboundUrl:"".concat("https://www.lonelyplanet.com","/").concat(c),webElement:{location:"MODAL",text:e.name,elementType:"BUTTON",...w}})},className:"flex-none mr-2 w-5 h-5 rounded-sm border-black-200 shadow-sm"}),(0,l.jsx)("span",{children:e.name})]},e.id))})})]}),(0,l.jsxs)("div",{className:"p-3 shadow-[0px_0px_18px_4px_rgba(0,0,0,0.14)]",children:[(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsxs)("div",{className:"flex-1 flex items-center rounded-l border border-r-none border-black-200",children:[(0,l.jsx)("input",{type:"text",value:k,onChange:e=>{let{value:t}=e.target;T(t)},placeholder:"Create a new list",className:"flex-1 border-none focus:ring-0 rounded-l text-sm",maxLength:40}),(0,l.jsx)("span",{className:o()("w-8 flex-none text-sm text-black-300",{"text-red":k.length>=40}),children:40-k.length})]}),(0,l.jsx)("button",{type:"button",onClick:()=>{A||D(!0),P(k)},className:"flex-none flex justify-center items-center !px-0 w-10 rounded-r border border-blue disabled:border-black-200 bg-blue text-white disabled:bg-white disabled:text-black-300",disabled:0===k.length||k>=40,children:(0,l.jsx)(p.O,{className:"text-sm"})})]}),(0,l.jsx)("button",{type:"submit",className:"btn btn-primary w-full mt-3",disabled:0===L.length||N||!A,children:"Save"})]})]})]})]})}),(0,l.jsx)(e,{...y,slug:c})]})}return n.propTypes={esid:i().string.isRequired,type:i().oneOf(["article","poi"]).isRequired,slug:i().string.isRequired,hocTagularCtx:i().shape({name:i().string,position:i().string})},n.defaultProps={hocTagularCtx:null},n}},38838:function(e,t,n){n.d(t,{w:function(){return a}});var l=n(85893),s=n(4701);let a=(0,s.H)(()=>(0,l.jsx)("path",{d:"M1 0.436401L5 4.37175L9 0.436401L10 1.42024L5 6.4624L8.68036e-07 1.42024L1 0.436401Z"}),{viewBox:"0 0 10 7"})},56839:function(e,t,n){n.d(t,{O:function(){return a}});var l=n(85893),s=n(4701);let a=(0,s.H)(()=>(0,l.jsx)("path",{d:"M19.8184 8.87499H12.0934V1.14999C12.0934 0.851625 11.9749 0.565477 11.7639 0.354499C11.553 0.14352 11.2668 0.0249939 10.9684 0.0249939C10.6701 0.0249939 10.3839 0.14352 10.1729 0.354499C9.96197 0.565477 9.84344 0.851625 9.84344 1.14999V8.87499H2.11694C1.81858 8.87499 1.53243 8.99352 1.32145 9.2045C1.11047 9.41548 0.991943 9.70163 0.991943 9.99999C0.991943 10.2984 1.11047 10.5845 1.32145 10.7955C1.53243 11.0065 1.81858 11.125 2.11694 11.125H9.84344V18.85C9.84344 19.1484 9.96197 19.4345 10.1729 19.6455C10.3839 19.8565 10.6701 19.975 10.9684 19.975C11.2668 19.975 11.553 19.8565 11.7639 19.6455C11.9749 19.4345 12.0934 19.1484 12.0934 18.85V11.125H19.8184C20.1168 11.125 20.403 11.0065 20.6139 10.7955C20.8249 10.5845 20.9434 10.2984 20.9434 9.99999C20.9434 9.70163 20.8249 9.41548 20.6139 9.2045C20.403 8.99352 20.1168 8.87499 19.8184 8.87499Z"}),{viewBox:"0 0 21 20"})},75606:function(e,t,n){n.d(t,{w:function(){return l}});let l=e=>e.replace(/\s/g,"-").toLowerCase()}}]);
//# sourceMappingURL=3186-433f5f6eb1137be6.js.map